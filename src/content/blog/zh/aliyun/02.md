---
title: "阿里云服务器折腾记录（二）"
date: "2026-01-12"
description: "frp与rustdesk云边协同方案"
---

> 1panel 配置加速地址：https://docker.1panel.live

---

## 🚀 架构总览：云边协同方案

* **云端（阿里云 - 武汉）：** 承担 **FRP Server** 与 **RustDesk Server** 职责，作为公网唯一的“接头点”。
* **边缘（本地 Ubuntu）：** 承担 **FRP Client** 与 **RustDesk Client** 职责，通过穿透隧道将算力、存储和桌面环境映射至公网。

---

## 🛠️ FRP 折腾日志：打通内网脉络

| 环节 | 关键要点 | 踩坑记录 |
| --- | --- | --- |
| **服务端 (frps)** | 部署在 1Panel，端口 7000。 | **防火墙**：需在“阿里云安全组”和“1Panel 防火墙”双重放行 7000 端口。 |
| **客户端 (frpc)** | 映射本地 22 端口到公网 6000。 | **127.0.0.1 陷阱**：`serverAddr` 必须填公网 IP，否则会报 `connection refused`。 |
| **安全加固** | 必须设置 `auth.token`。 | **SSH 安全**：公网暴露端口后，务必禁用密码登录，改用 SSH 密钥。 |
| **应用扩展** | 后续可映射 AList、数据库、开发端口。 | **性能**：利用 200M 带宽，支持多路并发映射不卡顿。 |

---

## 🖥️ RustDesk 折腾日志：自建高清中继站


### 1. 核心经验教训（必看）

* **监听 IP 绑定**：1Panel 默认可能绑定 `127.0.0.1`，必须修改为 **`0.0.0.0`**（最好使用 `host` 模式），否则公网流量无法进入。
* **UDP 的重要性**：`21116` 端口不仅要开 TCP，**必须开启 UDP**。否则客户端会一直显示“未就绪”。

### 2. 部署 Checklist

* **Key 认证**：从 `/data/id_ed25519.pub` 获取密钥，实现私有化加密连接。
* **自启动**：Ubuntu 物理机使用 `systemctl enable rustdesk` 确保开机即上线。
* **Wayland 适配**：若远程黑屏，需修改 `/etc/gdm3/custom.conf` 切换至 **X11**。

---

## 📈 资源利用率“榨干”手册

针对你的 **2 核 2G / 200M** 配置，后续运行建议：

1. **内存优化（针对 2GB）：**
* **Swap 是命根子**：已经在 1Panel 开启了 2-4G 的 Swap 虚拟内存，预防容器突发性 OOM。
* **容器克制**：云端只跑网关类应用（FRP、RustDesk、OpenResty）；重型应用（青龙面板、AList、数据库、OpenModelica 仿真）全部跑在**本地 Ubuntu** 上。


2. **带宽利用（针对 200Mbps）：**
* **高清办公**：RustDesk 设置“原画”模式，你的带宽足够支撑 4K/60 帧远程操作。
* **文件直连**：本地 AList 映射后，外网下载/看片最高可达 25MB/s。



---

## 📅 下一步折腾路线图

* **自动化 (自动化脚本)**：在本地 Ubuntu 部署**青龙面板**，通过 FRP 映射到公网进行管理，跑一些 Python 脚本。
* **云端图床/网盘**：既然你对 GitHub 感兴趣，可以配置 **PicGo + GitHub + AList**，利用高带宽构建个人私有图床。
